<h2 id="check-for-files">Check for files</h2>

<p>Log on to the supercomputer:</p>

<p><code>bash
ssh &lt;username&gt;@ssh.fsl.byu.edu
</code></p>

<p>Check to see if have these an <em>n4.nii.gz</em> file for all 20 participants:</p>

<p><code>bash
find \
~/compute/data/ \
-type f \
-name "n4.nii.gz"
</code></p>

<h2 id="only-if-you-are-missing-these-files">Only if you are missing these files</h2>

<p><code>bash
rsync \
-rauv \
--exclude="DICOMs"
~/fsl_groups/fslg_byustudent/compute/data/ \
~/compute/data
</code></p>

<h2 id="sync-over-template-files">Sync over Template Files</h2>

<p><code>bash
rsync \
-rauv \
~/fsl_groups/fslg_byustudent/templates \
~/
</code></p>

<h2 id="create-script-and-logfile-directories">Create Script and Logfile Directories</h2>

<p><code>bash
mkdir -p ~/logfiles/2015_11_09_1300
</code></p>

<h2 id="generate-batch-script">Generate Batch Script</h2>

<p><code>bash
cd ~/scripts/antsCorticalThickness
vi BatchScript.sh
</code></p>

<p>Press <code>a</code> to enter into <em>insert</em> mode.</p>

<h2 id="batchscriptsh">BatchScript.sh</h2>

<p><code>bash
#!/bin/bash
for subj in $(ls ~/compute/data/); do
sbatch \
-o ~/logfiles/2015_11_09_1300/output_${subj}.txt \
-e ~/logfiles/2015_11_09_1300/error_${subj}.txt \
~/scripts/antsCorticalThickness/JobScript.sh \
${subj}
sleep 1
done
</code></p>

<p>Press <code>esc</code> to enter into <em>command</em> mode. Type in <code>:wq</code> and press Return to save file.</p>

<h2 id="generate-job-script">Generate Job Script</h2>

<p><code>bash
vi JobScript.sh
</code></p>

<p>Press <code>a</code> to enter into <em>insert</em> mode.</p>

<h2 id="jobscriptsh">JobScript.sh</h2>

<p>```bash
#!/bin/bash
#SBATCH –time=50:00:00   # walltime
#SBATCH –ntasks=1   # number of processor cores (i.e. tasks)
#SBATCH –nodes=1   # number of nodes
#SBATCH –mem-per-cpu=16384M  # memory per CPU core</p>

<h1 id="compatibility-variables-for-pbs-delete-if-not-needed">Compatibility variables for PBS. Delete if not needed.</h1>
<p>export PBS_NODEFILE=<code>/fslapps/fslutils/generate_pbs_nodefile</code>
export PBS_JOBID=$SLURM_JOB_ID
export PBS_O_WORKDIR=”$SLURM_SUBMIT_DIR”
export PBS_QUEUE=batch</p>

<h1 id="set-the-max-number-of-threads-to-use-for-programs-using-openmp-should-be--ppn-does-nothing-if-the-program-doesnt-use-openmp">Set the max number of threads to use for programs using OpenMP. Should be &lt;= ppn. Does nothing if the program doesn’t use OpenMP.</h1>
<p>export OMP_NUM_THREADS=$SLURM_CPUS_ON_NODE</p>

<h1 id="load-modules-and-environmental-variables">LOAD MODULES AND ENVIRONMENTAL VARIABLES</h1>
<p>export ANTSPATH=/fslhome/<username>/apps/ants/bin/
PATH=${ANTSPATH}:${PATH}</username></p>

<h1 id="insert-code-and-run-your-programs-here">INSERT CODE, AND RUN YOUR PROGRAMS HERE</h1>
<p>SUBJ_DIR=/fslhome/<username>/compute/data/${1}
TEMPLATE_DIR=/fslhome/<username>/templates/NKI10andUnder
OUT_DIR=${SUBJ_DIR}/antsCorticalThickness
~/apps/ants/bin/antsCorticalThickness.sh -d 3 \
-a ${SUBJ_DIR}/t1/n4.nii.gz \
-e ${TEMPLATE_DIR}/T_template0.nii.gz \
-t ${TEMPLATE_DIR}/T_template0_BrainCerebellum.nii.gz \
-m ${TEMPLATE_DIR}/T_template0_BrainCerebellumProbabilityMask.nii.gz \
-f ${TEMPLATE_DIR}/T_template0_BrainCerebellumExtractionMask.nii.gz \
-p ${TEMPLATE_DIR}/Priors/priors%d.nii.gz \
-q 1 \
-o ${OUT_DIR}/
```</username></username></p>

<p>Press <code>esc</code> to enter into <em>command</em> mode. Type in <code>:wq</code> and press Return to save file.</p>

<h2 id="submit-batchscriptsh">Submit BatchScript.sh</h2>

<p>By submitting the <em>BatchScript.sh</em>, you will be looping through all your subject IDs and submitting a <em>JobScript.sh</em> for each participant in your list (i.e., ls).</p>

<p><code>bash
sh ~/scripts/antsCorticalThickness/BatchScript.sh
</code></p>

<h2 id="read-output-files">Read Output Files</h2>

<p><code>bash
cd ~/logfiles/2015_11_09_1300
tail output*.txt
</code></p>

<h2 id="read-error-files">Read Error Files</h2>

<p><code>bash
cd ~/logfiles/2015_11_09_1300
tail error*.txt
</code></p>
