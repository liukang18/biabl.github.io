<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Average Overlays with ANTsR &mdash; Brain Imaging and Behavior Lab</title>
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="Brain Imaging and Behavior Lab" />
    <meta name="title" content="Group Average Overlays with ANTsR ">
    <link rel="canonical" href="http://biabl.github.io/tutorials/structural/group_average/">
     
           
    <meta property="og:title" content="Group Average Overlays with ANTsR "/>
    <meta property="og:url" content="http://biabl.github.io/tutorials/structural/group_average/"/>
    
    
    <meta property="og:site_name" content="Brain Imaging and Behavior Lab">     
</head>
<body>
    <section class="site-nav">
        <header>
            <nav id="navigation">
                <a class="brand" href="/"><img alt="Inc" src="/images/logo.png"></a> 
                <a class="home" href="/">Blog</a>
                <a class="home" href="/tags/">Tags</a>
				<li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
                    <ul class="dropdown-menu multi-level">
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">General Topics</a>
                            <ul class="dropdown-menu">
                                <li><a href="/tutorials/general/unix-cheat-sheet/">Unix Cheat Sheet</a></li>
                				<li><a href="/tutorials/general/introduction-to-fulton-supercomputer-lab/">Introduction to Fulton Supercomputer</a></li>
                				<li><a href="/tutorials/general/submitting_jobs/">Submitting Batch Jobs on Supercomputer</a></li>
                				<li><a href="/tutorials/general/R/">Learn R</a></li>
                				<li><a href="/tutorials/general/install-freesurfer/">How to Install Freesurfer on Supercomputer</a></li>
                            </ul>
                        </li>
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Structural Imaging Topics</a>
                            <ul class="dropdown-menu">
                                <li><a href="/tutorials/structural/preprocessing_T1_weighted_images/">Preprocessing T1 Weighted Images</a></li>
                				<li><a href="/tutorials/structural/convert-to-nifti/">Other Ways to Convert to NIfTI</a></li>
                				<li><a href="/tutorials/structural/normalization/">Normalization</a></li>
                				<li><a href="/tutorials/structural/cortical_thickness/">Tissue Segmentation and Cortical Thickness</a></li>
                				<li><a href="/tutorials/structural/morphometry/">Various Morphometry Analyses</a></li>
                				<li><a href="/tutorials/structural/ANTsR/">ANTsR</a></li>
                				<li><a href="/tutorials/structural/group_average/">Group Average Overlays with ANTsR</a></li>
                				<li><a href="/tutorials/structural/roi/">ROI Analysis with DKT</a></li>
                            </ul>
                        </li>
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Diffusion Imaging Topics</a>
                            <ul class="dropdown-menu">
                                <li><a href="/tutorials/diffusion/preprocessing_diffusion_weighted_images/">Preprocessing Diffusion Weighted Images</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects<b class="caret"></b></a>
                    <ul class="dropdown-menu multi-level">
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">MIOS</a>
                            <ul class="dropdown-menu">
                                <li><a href="/projects/MIOS/corpus-callosum/">Corpus Callosum</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </nav>
        </header>
    </section>
    
<article>

    <div class="container">
        <header>
        	
            <div class="meta">
                By <address><a rel="author" href="" title="Naomi J. Goodrich-Hunsaker" target="_blank">Naomi J. Goodrich-Hunsaker</a></address> &mdash;
                <time pubdate datetime="2015-09-December" title="December 09, 2015">December 09, 2015</time>
            </div>
            <h1 class="title">Group Average Overlays with ANTsR</h1>
            
        </header>

        <section>
            <p>One of the best ways to look at group differences is to create an average of each group’s data. For example, if you wanted to look at cortical thickness differences in TBI versus OI, then you would want a group cortical thickness average for the TBI group and another group cortical thickness average of the OI group. Note that when creating group averages, images need to be in template space (i.e., warped to template).</p>

<h2 id="run-r">Run R</h2>

<p>Log into the supercomputer:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ssh &lt;username&gt;@ssh.fsl.byu.edu</code></pre></div>

<p>Load the environmental variables so that R will run on the supercomputer:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">module load r/3.2.1</code></pre></div>

<p>Launch R:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">R</code></pre></div>

<p>Let’s load our packages.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>ANTsR<span class="p">)</span></code></pre></div>

<p>Set path to directory containing your data:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">setwd</span><span class="p">(</span><span class="s">&quot;/path/to/data/&quot;</span><span class="p">)</span></code></pre></div>

<h2 id="import-data">Import Data</h2>

<p>Depending on how your groups are differentiated, for the SOBIK dataset:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">files<span class="o">=</span><span class="kp">list.files</span><span class="p">(</span>pattern<span class="o">=</span><span class="s">&quot;13.*&quot;</span><span class="p">)</span></code></pre></div>

<p>Otherwise, you will need to edit the pattern according to <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/list.files.html">regular expression rules</a>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ilist<span class="o">&lt;-</span><span class="kt">list</span><span class="p">()</span>
<span class="kr">for</span> <span class="p">(</span> i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>files<span class="p">)</span> <span class="p">)</span>
<span class="p">{</span>
  img<span class="o">&lt;-</span>antsImageRead<span class="p">(</span>files<span class="p">[</span>i<span class="p">])</span>
  img<span class="o">&lt;-</span>smoothImage<span class="p">(</span>img<span class="p">,</span><span class="m">1.5</span><span class="p">)</span>
  ilist<span class="p">[</span>i<span class="p">]</span><span class="o">&lt;-</span>img
<span class="p">}</span>
mask<span class="o">&lt;-</span>getMask<span class="p">(</span>antsImageRead<span class="p">(</span>files<span class="p">[</span><span class="m">1</span><span class="p">]))</span>
mat<span class="o">&lt;-</span>imageListToMatrix<span class="p">(</span>ilist<span class="p">,</span> mask<span class="p">)</span></code></pre></div>

<h2 id="create-average-image">Create Average Image</h2>

<p>It’s pretty simple to just take an average of each column. Be sure to change the name of your output file according to each group:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">aveImage<span class="o">=</span><span class="kp">t</span><span class="p">(</span><span class="kp">as.matrix</span><span class="p">(</span><span class="kp">colMeans</span><span class="p">(</span>mat<span class="p">,</span>na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>dims<span class="o">=</span><span class="m">1</span><span class="p">)))</span>
i.aveImage<span class="o">&lt;-</span>makeImage<span class="p">(</span>mask<span class="p">,</span>aveImage<span class="p">)</span>
antsImageWrite<span class="p">(</span>i.aveImage<span class="p">,</span>file<span class="o">=</span><span class="s">&quot;/path/to/ouput/aveImage.nii.gz&quot;</span><span class="p">)</span></code></pre></div>

<h2 id="subtract-groups">Subtract Groups</h2>

<p>For the equation x = a - b:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">c3d a.nii.gz b.nii.gz -scale -1 -add -o x.nii.gz</code></pre></div>

            
        </section>

        <footer>
            <address>
               <img src="/images/naomi.jpg">
                <p>Written by <strong><a rel="author" href="https://twitter.com/" title="" target="_blank">Naomi J. Goodrich-Hunsaker</a></strong><br>
                <span class="muted">Website Manager</span>
                </p>
            </address>

        </footer>

        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'biabl'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>

    <footer class="site-footer">
        <div class="container">
            &copy; 2015
            <nav>
                <a href="http://biabl.github.io">Brain Imaging and Behavior Lab</a>
            </nav>
            <nav class="social">
                 
                 
                <a href="/feed.xml" title="RSS Feed"><i class="icon icon-rss black"></i></a>
            </nav>
        </div>
    </footer>
    
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js" defer></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" defer></script>
  <script src="dist/js/bootstrap-submenu.min.js" defer></script>
  <style type="text/css">
<script src="/assets/main.js"></script>







</body>
</html>